<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Counter Pengunjung MGMP Matematika</title>
  <style>
    :root{
      --bg:#f8fbff; /* putih kebiruan */
      --card:#ffffff;
      --text:#0b214a; /* biru tua */
      --muted:#5a78a0;
      --accent:#1e90ff; /* dodger blue */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji";
      background:linear-gradient(180deg,var(--bg),#eef5ff);
      color:var(--text);
      display:flex; align-items:center; justify-content:center;
    }
    .card{
      background:var(--card);
      border-radius:16px;
      box-shadow:0 10px 30px rgba(30, 144, 255, 0.12);
      padding:20px 22px; width:min(520px,92vw);
      display:grid; grid-template-columns:1fr 1fr; gap:14px; align-items:center;
      border:1px solid #e8f0ff;
    }
    .title{ grid-column:1/-1; font-size:20px; font-weight:700; letter-spacing:0.2px }
    .subtitle{ grid-column:1/-1; margin-top:-6px; font-size:13px; color:var(--muted) }

    .metric{ border:1px dashed #d6e6ff; border-radius:12px; padding:12px; text-align:center }
    .metric .label{ font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.8px }
    .metric .value{ font-size:32px; font-weight:800; line-height:1.1 }

    .footer{ grid-column:1/-1; display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .dot{ width:8px; height:8px; border-radius:50%; background:var(--accent); display:inline-block; margin-right:6px }
    .status{ font-size:12px; color:var(--muted) }
    .brand{ font-size:12px; color:var(--muted) }

    @media (max-width:420px){ .card{ grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <main class="card" role="group" aria-label="Counter Pengunjung MGMP Matematika">
    <div class="title">Counter Pengunjung – MGMP Matematika</div>
    <div class="subtitle">Terpasang via <code>feryirawan-mat.github.io</code> menggunakan CountAPI</div>

    <section class="metric" aria-live="polite" aria-atomic="true">
      <div class="label">Total Kunjungan</div>
      <div id="total" class="value">—</div>
    </section>

    <section class="metric" aria-live="polite" aria-atomic="true">
      <div class="label">Kunjungan Hari Ini</div>
      <div id="today" class="value">—</div>
    </section>

    <div class="footer">
      <div class="status"><span class="dot" aria-hidden="true"></span><span id="status">Memuat…</span></div>
      <div class="brand">© MGMP Matematika</div>
    </div>
  </main>

  <script>
  (function(){
    // === Konfigurasi ===
    // Ganti namespace agar unik milik Anda (bebas, huruf-kecil-angka-dash saja)
    const NAMESPACE = "feryirawan-mgmp"; // <- boleh diganti
    const TOTAL_KEY = "total";

    // Key harian mengikuti format YYYYMMDD
    const todayKey = new Date().toISOString().slice(0,10).replaceAll('-','');

    // Batasi increment: 1x per perangkat per 24 jam
    const SEEN_KEY = "mgmp-counter-last-hit";
    const now = Date.now();
    const last = Number(localStorage.getItem(SEEN_KEY) || 0);
    const shouldHit = !last || (now - last) > 24*60*60*1000;

    const $total = document.getElementById('total');
    const $today = document.getElementById('today');
    const $status = document.getElementById('status');

    const api = {
      hit: (k, amount=1)=> fetch(`https://api.countapi.xyz/hit/${encodeURIComponent(NAMESPACE)}/${encodeURIComponent(k)}?amount=${amount}`)
                           .then(r=>r.json()),
      get: (k)=> fetch(`https://api.countapi.xyz/get/${encodeURIComponent(NAMESPACE)}/${encodeURIComponent(k)}`)
                           .then(r=>r.json())
    };

    async function update(){
      try{
        $status.textContent = shouldHit ? 'Mencatat kunjungan…' : 'Memuat statistik…';

        // Total
        const totalPromise = shouldHit ? api.hit(TOTAL_KEY, 1) : api.get(TOTAL_KEY);

        // Harian
        const dayKey = `daily-${todayKey}`;
        const todayPromise = shouldHit ? api.hit(dayKey, 1) : api.get(dayKey);

        const [totalRes, todayRes] = await Promise.all([totalPromise, todayPromise]);

        const totalVal = (totalRes && (totalRes.value ?? totalRes.count)) || 0;
        const todayVal = (todayRes && (todayRes.value ?? todayRes.count)) || 0;

        $total.textContent = new Intl.NumberFormat('id-ID').format(totalVal);
        $today.textContent = new Intl.NumberFormat('id-ID').format(todayVal);

        if(shouldHit){ localStorage.setItem(SEEN_KEY, String(now)); }
        $status.textContent = 'Aktif dan tersinkron.';
      }catch(err){
        console.error(err);
        $status.textContent = 'Gagal memuat. Menggunakan cadangan.';
        // Fallback: tampilkan badge gambar gratis (read-only)
        fallbackBadge();
      }
    }

    function fallbackBadge(){
      // hits.seeyoufarm.com – hanya sebagai tampilan total (tanpa JS)
      const img = document.createElement('img');
      img.alt = 'Total pengunjung';
      img.referrerPolicy = 'no-referrer-when-downgrade';
      img.src = 'https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=' + encodeURIComponent(location.host + location.pathname) + '&count_bg=%231E90FF&title_bg=%23EAF2FF&icon=&icon_color=%23E7E7E7&title=Total&edge_flat=false';
      img.style.maxWidth = '100%';
      const wrap = document.createElement('div');
      wrap.className = 'metric';
      wrap.innerHTML = '<div class="label">Cadangan</div>';
      wrap.appendChild(img);
      document.querySelector('main.card').appendChild(wrap);
    }

    update();
  })();
  </script>
</body>
</html>
